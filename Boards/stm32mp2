source $GTools_boards/stm32

SDK=$SDK_MP2

source $SDK

unset CFLAGS CPPFLAGS CXXFLAGS LDFLAGS MACHINE LD_LIBRARY_PATH

PLATFORM="stm32mp2"

CC_EXTERNAL_DT_PATH="../dt-stm32mp"
CC_EXTERNAL_DT_TFA_PATH=$CC_EXTERNAL_DT_PATH/tf-a
CC_EXTERNAL_DT_OPTEE_PATH=$CC_EXTERNAL_DT_PATH/optee
CC_EXTERNAL_DT_UBOOT_PATH=$CC_EXTERNAL_DT_PATH/u-boot
CC_EXTERNAL_DT_KERNEL_PATH=$CC_EXTERNAL_DT_PATH/linux

# unset CC_EXTERNAL_DT_PATH

CC_SCP_FIRMWARE_PATH="../SCP-firmware"


# TFA
TFA_CC_ARCH="ARCH=aarch64"

SPD=opteed
PLAT=${PLATFORM}
DTB_FILE_NAME=${CC_BOARD_NAME}.dtb
OPENSSL_DIR=${OECORE_NATIVE_SYSROOT}/usr
STM32MP_SDMMC=1
STM32MP_DDR4_TYPE=1
DEBUG=1
TFA_EXTERNAL_DT="$CC_EXTERNAL_DT_TFA_PATH"

# OPTEE
export CROSS_COMPILE64=$CROSS_COMPILE
OPTEE_CC_ARCH="ARCH=arm"

PLATFORM=${PLATFORM}
CFG_ARM64_core=y
CFLAGS="-std=gnu99"
LIBGCC_LOCATE_CFLAGS="--sysroot=${SDKTARGETSYSROOT}"
CFG_EMBED_DTB_SOURCE_FILE=${CC_BOARD_NAME}.dts
CFG_TEE_CORE_DEBUG=y
CFG_TEE_CORE_LOG_LEVEL=2
CFG_EXT_DTS=${CC_EXTERNAL_DT_OPTEE_PATH}
CFG_SCP_FIRMWARE=${CC_SCP_FIRMWARE_PATH}
CFG_SCMI_SCPFW=y

# UBOOT
UBOOT_DEFCONFIG="stm32mp25_revA_defconfig"
UBOOT_DEVICE_TREE="DEVICE_TREE=${CC_BOARD_NAME} "
EXT_DTS="$CC_EXTERNAL_DT_UBOOT_PATH"

# KERNEL
KERNEL_IMAGE_FILE="arch/arm64/boot/Image.gz"
KERNEL_DTB_FILES="arch/arm64/boot/dts/st/stm32mp2*.dtb"
unset KERNEL_LOADADDR
W=1
KBUILD_EXTDTS="$CC_EXTERNAL_DT_KERNEL_PATH"
KERNEL_BUILD_DIR=../build/stm32mp2/kernel
INSTALL_MOD_PATH="modules"

# LOADADDR=0x87000000
KERNEL_USER_MAKE_OPTIONS="Image.gz "
KERNEL_USER_MAKE_OPTIONS+="vmlinux "
KERNEL_USER_MAKE_OPTIONS+="dtbs "

KERNEL_DEFCONFIG="fragment-01-defconfig-cleanup.config "
KERNEL_DEFCONFIG+="fragment-02-defconfig-addons.config "
KERNEL_DEFCONFIG+="fragment-02-defconfig-addons-reva.config "

TFM_CC_CMAKE_BUILD_TYPE="debug"
TFM_CC_TFM_PLATFORM="stm/stm32mp257f_ev1"
TFM_OPTIONS="-DTFM_PROFILE=profile_small"
