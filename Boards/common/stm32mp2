. cc_cmd_clean.sh

export SDK=`g_config get_sdk MP2 path`

export tfa_file='tfa.stm32'
export fip_name="fip.bin"
export FIP="fip-a"

# source $SDK
# unset CFLAGS CPPFLAGS CXXFLAGS LDFLAGS MACHINE LD_LIBRARY_PATH


export PLATFORM="stm32mp2"

export CC_EXTERNAL_DT_PATH="../dt-stm32mp"
export CC_EXTERNAL_DT_TFA_PATH=$CC_EXTERNAL_DT_PATH/tf-a
export CC_EXTERNAL_DT_OPTEE_PATH=$CC_EXTERNAL_DT_PATH/optee
export CC_EXTERNAL_DT_UBOOT_PATH=$CC_EXTERNAL_DT_PATH/u-boot
export CC_EXTERNAL_DT_KERNEL_PATH=$CC_EXTERNAL_DT_PATH/linux

# unset CC_EXTERNAL_DT_PATH

export CC_SCP_FIRMWARE_PATH="../SCP-firmware"


# TFA
export CC_TFA_ARCH="ARCH=aarch64"
export CC_TFA_PLAT="PLAT=${PLATFORM}"
export CC_TFA_DEBUG="DEBUG=1"
export CC_TFA_CFLAGS="CFLAGS="
export CC_TFA_LDFLAGS="LDFLAGS="

export SPD=opteed
export DTB_FILE_NAME=${CC_BOARD_NAME}.dtb
export OPENSSL_DIR='${OECORE_NATIVE_SYSROOT}/usr'
export STM32MP_SDMMC=1
export STM32MP_DDR4_TYPE=1
export TFA_EXTERNAL_DT="$CC_EXTERNAL_DT_TFA_PATH"

# OPTEE
export CC_OPTEE_ARCH="ARCH=arm"
export CC_OPTEE_PLATFORM="PLATFORM=${PLATFORM}"
export CC_OPTEE_CFLAGS="CFLAGS=-std=gnu99"
export CC_OPTEE_LDFLAGS="LDFLAGS="
export CC_OPTEE_LIBGCC_LOCATE_CFLAGS='LIBGCC_LOCATE_CFLAGS=--sysroot=${SDKTARGETSYSROOT}'
export CC_OPTEE_CFLAGS32=''
export CROSS_COMPILE64='${CROSS_COMPILE}'

export CFG_ARM64_core=y
export CFG_EMBED_DTB_SOURCE_FILE=${CC_BOARD_NAME}.dts
export CFG_TEE_CORE_DEBUG=y
export CFG_TEE_CORE_LOG_LEVEL=2
export CFG_EXT_DTS=${CC_EXTERNAL_DT_OPTEE_PATH}
export CFG_SCP_FIRMWARE=${CC_SCP_FIRMWARE_PATH}
export CFG_SCMI_SCPFW=y

# UBOOT
export UBOOT_DEFCONFIG="stm32mp25_revA_defconfig"
export UBOOT_DEVICE_TREE="DEVICE_TREE=${CC_BOARD_NAME} "
export EXT_DTS="$CC_EXTERNAL_DT_UBOOT_PATH"

# KERNEL
export KERNEL_IMAGE_FILE="arch/arm64/boot/Image.gz"
export KERNEL_DTB_FILES="arch/arm64/boot/dts/st/stm32mp2*.dtb"
unset KERNEL_LOADADDR
export W=1
export KBUILD_EXTDTS="$CC_EXTERNAL_DT_KERNEL_PATH"
export KERNEL_BUILD_DIR=../build/stm32mp2/kernel
export INSTALL_MOD_PATH="modules"

# LOADADDR=0x87000000
export KERNEL_USER_MAKE_OPTIONS="Image.gz "
export KERNEL_USER_MAKE_OPTIONS+="vmlinux "
export KERNEL_USER_MAKE_OPTIONS+="dtbs "

export KERNEL_DEFCONFIG="fragment-01-defconfig-cleanup.config "
export KERNEL_DEFCONFIG+="fragment-02-defconfig-addons.config "
export KERNEL_DEFCONFIG+="fragment-02-defconfig-addons-reva.config "

export TFM_CC_CMAKE_BUILD_TYPE="debug"
export TFM_CC_TFM_PLATFORM="stm/stm32mp257f_ev1"
export TFM_OPTIONS="-DTFM_PROFILE=profile_small"
